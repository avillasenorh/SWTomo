<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>3. Correlaciones de ruido - SWTomo</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "3. Correlaciones de ruido";
    var mkdocs_page_input_path = "exercises/3_correlations.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> SWTomo</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Dispersión</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../dispersion/phase/">Velocidad de fase</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../dispersion/group/">Velocidad de group</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Ruido ambiente</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../noise/properties/">Caracterísicas</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../noise/correlations/">Correlaciones</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Tomografia</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../tomo/maps/">Mapas de dispersión</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Ejercicios</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../0_installation/">0. Instalación</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../1_earthquakes/">1. Medidas de dispersión</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../2_dispersion/">2. Modelos de velocidad</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">3. Correlaciones de ruido</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#31-procesado-manual-con-do_mft">3.1. Procesado manual con do_mft</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#32-procesado-automatico-utilizando-ftan">3.2. Procesado automático utilizando FTAN</a>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../4_tomography/">4. Tomografía</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../5_kernels/">5. Kernels de sensitividad</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../6_inversion/">6. Inversión 1D</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">SWTomo</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Ejercicios &raquo;</li>
        
      
    
    <li>3. Correlaciones de ruido</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="3-procesado-de-correlaciones-de-ruido-ambiente">3. Procesado de correlaciones de ruido ambiente</h1>
<p>En este ejercicio realizaremos medidas de velocidad de fase y de grupo
utilizando un método manual (<code>do_mft</code>) y un método automático.</p>
<p>Los datos que utilizaremos son correlaciones simétricas (promedio de la
parte causal y acausal) para estaciones en la Península Ibérica, Marruecos
y Canarias. En particular utilizaremos correlaciones entre la estación
ARAC (Aracena, Huelva) con todas las demás estaciones de banda ancha
con datos disponibles.</p>
<h2 id="31-procesado-manual-con-do_mft">3.1. Procesado manual con <code>do_mft</code></h2>
<p>La medida de curvas de dispersión para correlaciones de ruido ambiente con
<code>do_mft</code> es igual a la medida para registros de terremotos, excepto que,
al conocer la fuente de la correlación (fuerza impulsiva vertical) podemos
medir también la velocidad de fase (y no solo la de grupo como en el caso
de los terremotos).</p>
<p>Ir al directorio que contiene los archivos con las correlaciones de ruido ambiente:</p>
<pre><code>$ cd 
$ cd exercises/correlations
$ ls                                    # ver el contenido del directorio
</code></pre>
<p>Los archivos de correlación contienen el código de las dos estaciones utilizadas
y el sufijo <code>_ZZ_S</code> que indica que es una correlación simétrica (<code>_S</code>) entre
componentes verticales (<code>ZZ</code>).</p>
<p>Para seleccionar las velocidades de fase y de grupo de las correlaciones
de forma manual, ejecutar <code>do_mft</code> con las siguientes opciones:</p>
<pre><code>$ do_mft -G -IG *_ZZ_S
</code></pre>
<p>La pantalla que aparece es igual a la que obteníamos en el caso de terremotos,
excepto que aprarece una opción adicional: <code>PhVel</code></p>
<p><img alt="do_mft_corr_ftan" src="../do_mft_corr_ftan.png" /></p>
<p>Seleccionar la velocidad de grupo siguiendo los mismos pasos que en el ejercicio 1.
Cuando esté seleccionada hacer click en <code>PhVel</code>. Entonces aparecerá la pantalla siguiente:</p>
<p><img alt="do_mft_corr_phase" src="../do_mft_corr_phase.png" /></p>
<p>En el panel de la derecha se muestra de nuevo el análisis FTAN, y en el de la
izquierda las posibles curvas de velocidad de fase. Hay que seleccionar la curva
que tenga unos valores de la velocidad similares (un poco superiores) a la curva
de velocidad de grupo y/o unos valores razonables para periodos largos.
La selección se hace de la misma forma que con la velocidad de
grupo, pulsando primero <code>Auto</code> y después haciendo click sobre los puntos que se
quieren seleccionar. Los puntos seleccionados cambian a color blanco, como se 
muestra en la siguiente figura:</p>
<p><img alt="do_mft_corr_phase_selected" src="../do_mft_corr_phase_selected.png" /></p>
<p>También cambian a color blanco los puntos equivalentes el la curva de velocidad
de grupo.</p>
<p>Para salvar la curva de velocidad de fase hacer click en <code>Save</code>. Esto generará 
un archivo con el mismo nombre que el archivo del sismograma, añadiéndole la
extensión <code>.phv</code>. Después de guardar el archivo de velocidad de fase el programa
vuelve a la pantalla de velocidad de grupo. En esta hay que pulsar <code>Exit</code> para
guardar el archivo con la velocidad de grupo (extensión <code>.dsp</code>).</p>
<p>Seleccionar por ejemplo el archivo <code>COR_ARAC.IG._MVO.PM._ZZ_S</code>, que es el
resultado de correlacionar las componentes verticales (Z) de las estaciones
ARAC (Aracena) y MVO (Marvao, Portugal). Realizar la medida de la velocidad de
fase y de grupo y guardar los resultados (archivos <code>COR_ARAC.IG._MVO.PM._ZZ_S.phv</code> y
<code>COR_ARAC.IG._MVO.PM._ZZ_S.dsp</code> respectivamente). Estas curvas pueden visualizarse
utilizando el script <code>plot_aftan_disp.sh</code>:</p>
<pre><code>$ plot_aftan_disp.sh COR_ARAC.IG._MVO.PM.   # COR_ARAC.IG._MVO.PM. es el prefijo de los archivos .dsp y .phv
</code></pre>
<p>El script producirá un warning de que faltan ciertos archivos (esto es normal puesto que no han sido creados todavía)
y generará un archivo en formato PostScript <code>COR_ARAC.IG._MVO.PM..ps</code> que puede visualizarse con el programa <code>gv</code>:</p>
<pre><code>$ gv COR_ARAC.IG._MVO.PM..ps                 # presionar "q" para salir de gv
</code></pre>
<p><img alt="cor_manual" src="../cor_manual.png" /></p>
<p>La curva obtenida debe ser similar a la figura previa. La línea continua roja corresponde a
la velocidad de fase de la onda Rayleigh y la línea discontinua roja la velocidad de grupo.</p>
<p>Debe observarse que la velocidad de grupo es inferior a la velocidad de fase. La velocidad de
fase en general será creciente con el periodo, mientras que la velocidad de grupo puede 
decrecer y presentar máximos y/o mínimos.
verify that phase velocity curves usually do not have minima, while group
velocities often have.</p>
<h2 id="32-procesado-automatico-utilizando-ftan">3.2. Procesado automático utilizando <code>FTAN</code></h2>
<p>Crear un archivo de parámetros llamado <code>aftan.par</code>(p.e. utilizando <code>gedit</code>) que contenga esta línea:</p>
<pre><code>-1 1.0 5.0 2 100 20 1 0.5 0.2 2 COR_ARAC.IG._MVO.PM._ZZ_S
</code></pre>
<p>El significado de los valores en las diferentes columnas es el siguiente:</p>
<ol>
<li>valor interno (ha de ser siempre -1)</li>
<li>velocidad mínima (km/s)</li>
<li>velocidad máxima (km/s)</li>
<li>periodo mínimo (segundos)</li>
<li>periodo máximo (segundos)</li>
<li>umbral (threshold). Normalmente 10 ó 20</li>
<li>factor para el parámetro de filtrado</li>
<li>factor para el taper a la izquierda del sismograma</li>
<li>signal-to-noise ratio para el phase-matched filter</li>
<li>factor para determinar la ventana del phase-matched filter</li>
<li>nombre del archivo con el sismograma/correlación a procesar</li>
</ol>
<p>Además del archivo de parámetros <code>aftan.par</code> también es necesario un archivo que contenga
una curva de velocidad de fase de referencia (promedio). Este archivo se utiliza para hacer
el phase-unwrapping a periodos largos y poder decidir la curva de velocidad de fase correcta.
El archivo ha de tener el nombre <code>avg_phvel.dat</code>
y su contenido es simplemente una tabla con dos columnas:
periodo (s) versus velocidad de fase (Rayleigh o Love):</p>
<pre><code>25   3.67411208
29   3.731354
33   3.7900126
40   3.83514428
50   3.85978866
66   3.89791131
83   3.94684219
100  4.00932217
</code></pre>
<p>El programa que lleva a cabo el análisis <code>FTAN</code> de forma automática se llama <code>aftani_c_pgl</code> y se ejecuta
de la siguiente forma:</p>
<pre><code>$ aftani_c_pgl aftan.par
</code></pre>
<p>El programa genera muchos archivos de salida por cada sismograma. El ouptut final está en el archivo
con el sufijo <code>_2_DISP.1</code>. En particular, el archivo <code>COR_ARAC.IG._MVO.PM._ZZ_S_2_DISP.1</code> debería
tener el siguiente ascpecto:</p>
<pre><code>   0     2.4990     3.0738       3.0559       3.1335      89.2118   26.546
   1     2.8116     3.1951       3.0545       3.1366      95.1781   18.675
   2     3.1634     3.3792       3.0490       3.1416      98.6959   21.576
   3     3.5591     3.6418       3.0442       3.1492     100.0007   43.248
   4     4.0043     3.9751       3.0510       3.1592      99.5837   48.041
   5     4.5052     4.4000       3.0775       3.1703      97.9055   38.064
   6     5.0687     4.9757       3.1094       3.1813      95.7282   26.265
   7     5.7028     5.6677       3.1311       3.1901      94.0639   34.596
   8     6.4162     6.4176       3.1042       3.1983      92.8465  112.891
   9     7.2188     7.4175       3.0536       3.2166      92.2072   16.057
  10     8.1218     8.7391       3.0346       3.2492      93.0338   13.191
  11     9.1377     9.9074       3.0261       3.2804      95.5471   98.594
  12    10.2808    10.8113       3.0117       3.3062      97.7322  102.493
  13    11.5668    11.8363       3.0007       3.3376      98.5755   91.330
  14    13.0137    13.1025       3.0022       3.3784      98.3737  184.567
  15    14.6417    14.5310       3.0122       3.4247      97.4745  177.030
  16    16.4732    16.0903       3.0118       3.4755      95.8104   78.610
  17    18.5339    17.9128       2.9961       3.5380      93.3626   70.694
  18    20.8523    20.1754       2.9984       3.6215      90.5481  168.184
  19    23.4607    22.9816       3.0772       3.7260      88.0634  158.935
  20    26.3955    26.2221       3.2712       3.8283      86.3873   60.217
  21    29.6973    29.5927       3.5260       3.8993      85.2403  153.496
  22    33.4122    33.1429       3.7558       3.9379      84.0305  151.759
  23    37.5918    37.0773       3.9421       3.9523      82.5334  148.996
  24    42.2942    41.5040       4.0807       3.9475      80.7447  148.715
  25    47.5848    46.5026       4.1547       3.9284      78.7052  149.816
  26    53.5373    52.1546       4.1597       3.9017      76.4666  141.282
  27    60.2344    58.5435       4.1048       3.8736      74.0783  135.621
  28    67.7692    65.7614       4.0021       3.8502      71.5822  128.444
  29    76.2465    73.9076       3.8824       3.8368      69.0113  120.928
  30    85.7843    83.0915       3.7825       3.8357      66.3888  116.806
  31    96.5152    93.4423       3.6997       3.8459      63.7319  113.398
</code></pre>

<p>El significado de las columnas relevantes es:</p>
<ol>
<li>número de medida</li>
<li>periodo nominal de la medida (segundos)</li>
<li>periodo instantáneo de la medida (segundos); este es el valor que nos interesa</li>
<li>velocidad de grupo (km/s)</li>
<li>velocidad de fase (km/s)</li>
</ol>
<p>El archivo resultante <code>COR_ARAC.IG._MVO.PM._ZZ_S_2_DISP.1</code> puede dibujarse también
con el mismo script que utilizamos para las medidas manuales con <code>do_mft</code>:</p>
<pre><code>$ plot_aftan_disp.sh COR_ARAC.IG._MVO.PM.
$ gv COR_ARAC.IG._MVO.PM..ps
</code></pre>
<p>Si para el mismo par de estaciones existen medidas hechas con <code>do_mft</code> y con 
<code>aftani_c_pgl</code> se superpondrán en el mismo dibujo:</p>
<p><img alt="cor_manual_auto" src="../cor_manual_auto.png" /></p>
<p>En la gráfica superior las curvas en marrón corresponden a las medidas obtenidas
con el método automático <code>aftani_c_pgl</code>, y las rojas con el método manual <code>do_mft</code>.
En ambos casos las líneas continuas corresponden a velocidad de fase, y las
discontinuas a velocidad de grupo.</p>
<p>Ejercicio: Cómo haríais para procesar todos los archivos de correlación
en el directorio de trabajo (455 archivos).</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../4_tomography/" class="btn btn-neutral float-right" title="4. Tomografía">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../2_dispersion/" class="btn btn-neutral" title="2. Modelos de velocidad"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../2_dispersion/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../4_tomography/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
